<%
  def to_select(arry)
    arry.sort_by{|x|x.short_name}.collect {|x|[x.short_name.to_s,x.id.to_s]}
  end

  options = []
  group = @page.group
  if group 
    if group.committee?
      committees = to_select(group.parent.committees) + [[group.parent.short_name,group.parent.id]]
    else
      committees = to_select(group.committees)
    end
    if committees.any?
      options << '<optgroup label="%s">' % 'committees'
      options << options_for_select(committees)
      options << '</optgroup>'
    end
  end

  groups = to_select(current_user.groups)
  if groups.any?
    selected = group ? group.id.to_s : ''
    options << '<optgroup label="%s">' % 'groups'
    options << options_for_select(groups, selected)
    options << '</optgroup>'
  end
-%>
<% popup('Move This Page'[:move_this_page], :id => 'move_popup', :style => '') do -%>
  <% form_tag(:controller => 'base_page/participation', :action => 'move', :page_id => @page.id) do -%>
    <%= "Move this page to a different group"[:move_page_to_different_group] %>:
    <p>
      <%= select_tag 'group_id', options.join("\n") %>
    </p>
    <p>
      <%= submit_tag :move_button.t, :name => 'move' %>
      <%= submit_tag :close_button.t, :name => 'cancel' %>
    </p>
  <% end -%>
<% end -%>

