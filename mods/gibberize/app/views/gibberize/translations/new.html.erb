<h1>New translation</h1>

<%= error_messages_for :translation %>

<% form_for(@translation) do |f| %>
  <p>
    <b>Key</b><br />
    <%= h @translation.key.name %>
    <%= hidden_field(:translation, :key_id) %>
  </p>

  <p>
    <b>Language</b><br />
    <%= f.collection_select(:language_id, @translation.key.untranslated_languages, :id, :name) %>
  </p>

  <p>
    <b>Text</b><br />
    <%= f.text_field :text %>
  </p>

  <p>
    <%= f.submit "Create" %>
  </p>
<% end %>

<% if @translation.key && @translation.language %>

  <% original = Translation.best_guess(@translation.key, default_language) %>
  <% current = Translation.best_guess(@translation.key, @translation.language) %>

  <p>
    <b>Original (needs a javascript update when the key changes)</b><br />
    <%= original %>
  </p>

<% if current %>
  <p>
    <b>Current translation</b><br />
    <%= current %>
  </p>
<% end %>
  <p>
    <b>Google Says</b><br />
    <span id="googletranslate">Loading...</span>
  </p>

<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
  google.load("language", "1");
  function initialize() {
    google.language.translate('<%= original %>', 
                              '<%= default_language.code[0..(default_language.code =~ /_/)-1] %>', 
                              '<%= @translation.language.code[0..(@translation.language.code =~ /_/)-1] %>',
      function(result) {
        var translated = document.getElementById("googletranslate");
        if (result.translation) {
          translated.innerHTML = result.translation;
        }
      });
  };

  google.setOnLoadCallback(initialize);

</script>

<% end %>

<!-- %= update_page_tag { |page| page[:translation_text].focus } % -->
<! --%= link_to 'Back', translations_path % --> 

<%= link_to 'Back', @translation.key %>
