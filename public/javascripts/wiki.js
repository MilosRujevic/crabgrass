if(typeof(Control)=="undefined"){Control={}}var $proc=function(a){return typeof(a)=="function"?a:function(){return a}};var $value=function(a){return typeof(a)=="function"?a():a};Object.Event={extend:function(a){a._objectEventSetup=function(b){this._observers=this._observers||{};
this._observers[b]=this._observers[b]||[]};a.observe=function(d,b){if(typeof(d)=="string"&&typeof(b)!="undefined"){this._objectEventSetup(d);if(!this._observers[d].include(b)){this._observers[d].push(b)
}}else{for(var c in d){this.observe(c,d[c])}}};a.stopObserving=function(c,b){this._objectEventSetup(c);if(c&&b){this._observers[c]=this._observers[c].without(b)}else{if(c){this._observers[c]=[]}else{this._observers={}
}}};a.observeOnce=function(d,c){var b=function(){c.apply(this,arguments);this.stopObserving(d,b)}.bind(this);this._objectEventSetup(d);this._observers[d].push(b)};a.notify=function(g){this._objectEventSetup(g);
var d=[];var b=$A(arguments).slice(1);try{for(var c=0;c<this._observers[g].length;++c){d.push(this._observers[g][c].apply(this._observers[g][c],b)||null)}}catch(f){if(f==$break){return false}else{throw f
}}return d};if(a.prototype){a.prototype._objectEventSetup=a._objectEventSetup;a.prototype.observe=a.observe;a.prototype.stopObserving=a.stopObserving;a.prototype.observeOnce=a.observeOnce;a.prototype.notify=function(g){if(a.notify){var b=$A(arguments).slice(1);
b.unshift(this);b.unshift(g);a.notify.apply(a,b)}this._objectEventSetup(g);var b=$A(arguments).slice(1);var d=[];try{if(this.options&&this.options[g]&&typeof(this.options[g])=="function"){d.push(this.options[g].apply(this,b)||null)
}for(var c=0;c<this._observers[g].length;++c){d.push(this._observers[g][c].apply(this._observers[g][c],b)||null)}}catch(f){if(f==$break){return false}else{throw f}}return d}}}};Element.addMethods({observeOnce:function(c,d,b){var a=function(){b.apply(this,arguments);
Element.stopObserving(c,d,a)};Element.observe(c,d,a)}});Object.extend(Event,(function(){var b=Event.cache;function c(j){if(j._prototypeEventID){return j._prototypeEventID[0]}arguments.callee.id=arguments.callee.id||1;
return j._prototypeEventID=[++arguments.callee.id]}function g(j){if(j&&j.include(":")){return"dataavailable"}if(!Prototype.Browser.IE){j={mouseenter:"mouseover",mouseleave:"mouseout"}[j]||j}return j}function a(j){return b[j]=b[j]||{}
}function f(l,j){var k=a(l);return k[j]=k[j]||[]}function h(k,j,l){var o=c(k);var n=f(o,j);if(n.pluck("handler").include(l)){return false}var m=function(p){if(!Event||!Event.extend||(p.eventName&&p.eventName!=j)){return false
}Event.extend(p);l.call(k,p)};if(!(Prototype.Browser.IE)&&["mouseenter","mouseleave"].include(j)){m=m.wrap(function(r,q){var p=q.relatedTarget;var s=q.currentTarget;if(p&&p.nodeType==Node.TEXT_NODE){p=p.parentNode
}if(p&&p!=s&&!p.descendantOf(s)){return r(q)}})}m.handler=l;n.push(m);return m}function i(m,j,k){var l=f(m,j);return l.find(function(n){return n.handler==k})}function d(m,j,k){var l=a(m);if(!l[j]){return false
}l[j]=l[j].without(i(m,j,k))}function e(){for(var k in b){for(var j in b[k]){b[k][j]=null}}}if(window.attachEvent){window.attachEvent("onunload",e)}return{observe:function(l,j,m){l=$(l);var k=g(j);var n=h(l,j,m);
if(!n){return l}if(l.addEventListener){l.addEventListener(k,n,false)}else{l.attachEvent("on"+k,n)}return l},stopObserving:function(l,j,m){l=$(l);var o=c(l),k=g(j);if(!m&&j){f(o,j).each(function(p){l.stopObserving(j,p.handler)
});return l}else{if(!j){Object.keys(a(o)).each(function(p){l.stopObserving(p)});return l}}var n=i(o,j,m);if(!n){return l}if(l.removeEventListener){l.removeEventListener(k,n,false)}else{l.detachEvent("on"+k,n)
}d(o,j,m);return l},fire:function(l,k,j){l=$(l);if(l==document&&document.createEvent&&!l.dispatchEvent){l=document.documentElement}var m;if(document.createEvent){m=document.createEvent("HTMLEvents");m.initEvent("dataavailable",true,true)
}else{m=document.createEventObject();m.eventType="ondataavailable"}m.eventName=k;m.memo=j||{};if(document.createEvent){l.dispatchEvent(m)}else{l.fireEvent(m.eventType,m)}return Event.extend(m)}}})());Object.extend(Event,Event.Methods);
Element.addMethods({fire:Event.fire,observe:Event.observe,stopObserving:Event.stopObserving});Object.extend(document,{fire:Element.Methods.fire.methodize(),observe:Element.Methods.observe.methodize(),stopObserving:Element.Methods.stopObserving.methodize()});
(function(){function a(c){var d;if(c.wheelDelta){d=c.wheelDelta/120}else{if(c.detail){d=-c.detail/3}}if(!d){return}var b=c.element().fire("mouse:wheel",{delta:d});if(b.stopped){c.stop();return false}}document.observe("mousewheel",a);
document.observe("DOMMouseScroll",a)})();var IframeShim=Class.create({initialize:function(){this.element=new Element("iframe",{style:"position:absolute;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);display:none",src:"javascript:void(0);",frameborder:0});
$(document.body).insert(this.element)},hide:function(){this.element.hide();return this},show:function(){this.element.show();return this},positionUnder:function(a){var a=$(a);var c=a.cumulativeOffset();
var b=a.getDimensions();this.element.setStyle({left:c[0]+"px",top:c[1]+"px",width:b.width+"px",height:b.height+"px",zIndex:a.getStyle("zIndex")-1}).show();return this},setBounds:function(a){for(prop in a){a[prop]+="px"
}this.element.setStyle(a);return this},destroy:function(){if(this.element){this.element.remove()}return this}});if(typeof(Prototype)=="undefined"){throw"Control.TextArea requires Prototype to be loaded."
}if(typeof(Object.Event)=="undefined"){throw"Control.TextArea requires Object.Event to be loaded."}Control.TextArea=Class.create({initialize:function(a){this.onChangeTimeout=false;this.element=$(a);$(this.element).observe("keyup",this.doOnChange.bindAsEventListener(this));
$(this.element).observe("paste",this.doOnChange.bindAsEventListener(this));$(this.element).observe("input",this.doOnChange.bindAsEventListener(this));if(!!document.selection){$(this.element).observe("mouseup",this.saveRange.bindAsEventListener(this));
$(this.element).observe("keyup",this.saveRange.bindAsEventListener(this))}},doOnChange:function(a){if(this.onChangeTimeout){window.clearTimeout(this.onChangeTimeout)}this.onChangeTimeout=window.setTimeout(function(){this.notify("change",this.getValue())
}.bind(this),Control.TextArea.onChangeTimeoutLength)},saveRange:function(){this.range=document.selection.createRange()},getValue:function(){return this.element.value},getSelection:function(){if(!!document.selection){return document.selection.createRange().text
}else{if(!!this.element.setSelectionRange){return this.element.value.substring(this.element.selectionStart,this.element.selectionEnd)}else{return false}}},replaceSelection:function(c){var b=this.element.scrollTop;
if(!!document.selection){this.element.focus();var a=(this.range)?this.range:document.selection.createRange();a.text=c;a.select()}else{if(!!this.element.setSelectionRange){var d=this.element.selectionStart;
this.element.value=this.element.value.substring(0,d)+c+this.element.value.substring(this.element.selectionEnd);this.element.setSelectionRange(d+c.length,d+c.length)}}this.doOnChange();this.element.focus();
this.element.scrollTop=b},wrapSelection:function(a,b){this.replaceSelection(a+this.getSelection()+b)},insertBeforeSelection:function(a){this.replaceSelection(a+this.getSelection())},insertAfterSelection:function(a){this.replaceSelection(this.getSelection()+a)
},collectFromEachSelectedLine:function(c,a,b){this.replaceSelection((a||"")+$A(this.getSelection().split("\n")).collect(c).join("\n")+(b||""))},insertBeforeEachSelectedLine:function(c,a,b){this.collectFromEachSelectedLine(function(d){},a,b)
}});Object.extend(Control.TextArea,{onChangeTimeoutLength:500});Object.Event.extend(Control.TextArea);Control.TextArea.ToolBar=Class.create({initialize:function(a,b){this.textarea=a;if(b){this.container=$(b)
}else{this.container=$(document.createElement("ul"));this.textarea.element.parentNode.insertBefore(this.container,this.textarea.element)}},attachButton:function(a,b){a.onclick=function(){return false};
$(a).observe("click",b.bindAsEventListener(this.textarea))},addButton:function(d,g,e){var b=document.createElement("li");var c=document.createElement("a");c.href="#";c.title=d;if(e["class"]){Element.extend(c).addClassName(e["class"]);
e["class"]=null}this.attachButton(c,g);b.appendChild(c);Object.extend(c,e||{});if(d){var f=document.createElement("span");f.innerHTML=d;c.appendChild(f)}this.container.appendChild(b)}});function wiki_edit_add_toolbar(f,b,e,d){var a=new Control.TextArea(f);
var c=new Control.TextArea.ToolBar(a);c.container.addClassName("markdown_toolbar");c.container.id=b;c.addButton("Emphasis",function(){this.wrapSelection("_","_")},{"class":"markdown_italics_button",id:"markdown_italics_button-"+e});
c.addButton("Strong emphasis",function(){this.wrapSelection("*","*")},{"class":"markdown_bold_button",id:"markdown_bold_button-"+e});c.addButton("Link",function(){var h=this.getSelection();var g=prompt("Enter Link Target","");
if(g==null){return}this.replaceSelection("["+(h==""?"Link Text":h)+"->"+(g==""?"http://link_url/":g)+"]")},{"class":"markdown_link_button",id:"markdown_link_button-"+e});c.addButton("Image",function(){d()
},{"class":"markdown_image_button",id:"markdown_image_button-"+e});c.addButton("Heading",function(){var g=this.getSelection();if(g==""){g="Heading"}this.replaceSelection("\nh1. "+g+"\n")},{"class":"markdown_heading_button",id:"markdown_heading_button-"+e});
c.addButton("Unordered List",function(g){this.collectFromEachSelectedLine(function(h){return g.shiftKey?(h.match(/^\*{2,}/)?h.replace(/^\*/,""):h.replace(/^\*\s/,"")):(h.match(/\*+\s/)?"*":"* ")+h})},{"class":"markdown_unordered_list_button",id:"markdown_unordered_list_button-"+e});
c.addButton("Ordered List",function(h){var g=0;this.collectFromEachSelectedLine(function(i){return h.shiftKey?(i.match(/^\#{2,}/)?i.replace(/^\#/,""):i.replace(/^\#\s/,"")):(i.match(/\#+\s/)?"#":"# ")+i
})},{"class":"markdown_ordered_list_button",id:"markdown_ordered_list_button-"+e});c.addButton("Block Quote",function(g){this.collectFromEachSelectedLine(function(h){return g.shiftKey?h.replace(/^\> /,""):"> "+h
})},{"class":"markdown_quote_button",id:"markdown_quote_button-"+e});c.addButton("Code Block",function(g){this.wrapSelection("<code>","</code>")},{"class":"markdown_code_button",id:"markdown_code_button-"+e});
c.addButton("Help",quickRedReference,{"class":"markdown_help_button",id:"markdown_help_button-"+e})}function updateEditor(b,d,f){if(b.status!=200){return false}var c=nicEditors.findEditor("wiki_editor-"+f);
var a=$("wiki_body-"+f);var e=$("wiki_preview-"+f);if(b.responseJSON.body_preview){e.update(getBackNewLines(b.responseJSON.body_preview))}else{e.update("");c.setContent(getBackNewLines(b.responseJSON.body_html)||"");
a.setValue(getBackNewLines(b.responseJSON.body)||"")}if(d=="greencloth"){showTab($("link-tab-greencloth"),$("tab-edit-greencloth"))}else{if(d=="html"){showTab($("link-tab-html"),$("tab-edit-html"))}else{if(d=="preview"){showTab($("link-tab-preview"),$("tab-edit-preview"))
}}}}function getBackNewLines(a){if(a){return a.replace(/__NEW_LINE__/g,"\n").replace(/__TAB_CHAR__/g,"\t")}}function isTabSelected(a){return $(a).hasClassName("active")}function encodedEditorData(c){var b=$("wiki_body-"+c);
var a=nicEditors.findEditor("wiki_editor-"+c);if(b.getValue()){return b.serialize()}if(a.getContent()){return $H({"wiki[body_html]":a.getContent()}).toQueryString()}}function editorData(b,a){var c="";if(b=="greencloth"){c=$("wiki_body-"+a).getValue()
}else{if(b=="html"){c=nicEditors.findEditor("wiki_editor-"+a).getContent();if(c=="<br>"){c=""}}}return c}function selectWikiEditorTab(b,a){if(isTabSelected(a.tab_id)){return false}else{if(editorData(a.editor,a.wiki_id)){showTab(a.tab_id,a.area_id)
}else{new Ajax.Request(b,{asynchronous:true,evalScripts:true,method:"post",onComplete:function(c){updateEditor(c,a.editor,a.wiki_id)},onLoading:function(c){showTab(a.tab_id,"tab-edit-loading")},parameters:encodedEditorData(a.wiki_id)+"&authenticity_token="+encodeURIComponent(a.token)})
}}return true}if(typeof(nicEditors)!="undefined"){var nicFunctionButton=nicEditorButton.extend({mouseClick:function(){this.ne.options[this.options.onclick]()}});var nicCgImageOptions={buttons:{image:{name:"Add Image",type:"nicFunctionButton",onclick:"onImgButtonClick"}}};
nicEditors.registerPlugin(nicPlugin,nicCgImageOptions)};